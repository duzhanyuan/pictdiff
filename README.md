# pictdiff

This program implements image comparison by generating an image for visual inspection.

For example, given two images:

![Original image](https://raw.githubusercontent.com/elvis-epx/pictdiff/master/img/old.png) ![Original image](https://raw.githubusercontent.com/elvis-epx/pictdiff/master/img/new.png)

The difference image generated by the utility looks like this:

![Original image](https://raw.githubusercontent.com/elvis-epx/pictdiff/master/img/diff.png) 

You can compare the images in inverse order, which generates a similar but differently
tinted diff image:

![Original image](https://raw.githubusercontent.com/elvis-epx/pictdiff/master/img/diffinv.png) 

There is a Python reference implementation, and implementations in other languages: Rust, Go and Node.js.
Currently, the Rust version is the fastest (100x the reference implementation).

How to use the Python version:

```
./pictdiff.py img1.png img2.png diff.png
```

Apart from the "diff" image, the utility also prints a difference metric:

```
pictdiff/img $ ../pictdiff.py old.png new.png diff.png
2089964
```

This is a very rough metric, and the number gets big very fast. 
It is mostly useful to idenfity images that are exactly equal:

```
pictdiff/img $  ../pictdiff.py old.png old.png diff.png
0
````

# How to interpret the diff image

The diff "blank" image is white. Colorization of the diff image
is proportional: pixels are darker as the differences are
more intense.

Differences are also tinted to reflect the color changes.
For example, if "img1"
is generally more red than "img2", then "diff" will be cyan. On the
other hand, if "img2" is more red than "img1", then "diff" will be red-tinted.

Differences in alpha (opacity) have twofold effects. They are added
to the total absolute difference, which are rendered as gray in diff
image. This guarantees that alpha differences will be clearly revealed,
even if the color did not change.

Also, the color channels are multiplied by alpha, so the color differences
are mitigated when both images are quite transparent. In the extreme case, two
completely transparent images (alpha=0) will be considered equal, even
if one is "red" and another is "blue".

# Rust version

The Python version is quite slow, especially for big imgaes. If you can install
the Rust toolchain, you can run the Rust version instead:

```
cargo run --release img1.png img2.png diff.png
```

After it runs the first time succesfully, you can copy the binary
from target/release/pictdiff to /usr/local/bin or other convenient
location.

# Go version

Assuming you have the Go toolchain installed and configured:

```
go build pictdiff.go
```

Run the executable "pictdiff" created in the folder. The command 
"go run" also runs it, albeit more slowly.

# Node.js version

Assuming you have Node.js installed:

```
npm install
node pictdiff.node old.png new.png diffmap.png
```

# Motivation

The 'compare' tool from ImageMagick almost does what I want, but it
marks any difference as a red pixel. The threshold can be configured,
but the generated diff image is an all-or-nothing comparison. I needed
a diff image for quick inspection of changes, and the image should show
the magnitude of these differences, as well as how color was affected.

# Bugs

Not tested with 48-bit images. (Python Imaging Library does not open
48-bit TIFFs; Rust image crate does not support 48-bit yet.)

# Contact

Elvis Pf√ºtzenreuter - epxx@epxx.co - https://epxx.co
